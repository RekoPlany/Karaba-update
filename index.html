<!DOCTYPE html>
<html lang="ku" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>هەژمارکردنی کارەبا</title>
    <!-- Corrected Paths for Karaba-update -->
    <link rel="manifest" href="/Karaba-update/manifest.json">
    <meta name="theme-color" content="#121828">
    <link rel="apple-touch-icon" href="/Karaba-update/icon-192.png">
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <style>/* ... ستایلەکان وەک خۆی بمێننەوە ... */:root{--dark-bg:#121828;--container-bg:rgba(30, 41, 59, 0.6);--input-bg:rgba(51, 65, 85, 0.5);--accent:#00f5c3;--accent-dark:#00c49e;--text-primary:#f1f5f9;--text-secondary:#94a3b8;--danger:#ef4444;--success:#22c55e;--border-color:rgba(71, 85, 105, 0.5);--shadow-color:rgba(0, 245, 195, 0.1);--font-family:'Poppins', sans-serif}*{margin:0;padding:0;box-sizing:border-box}html{overflow-x:hidden}body{font-family:var(--font-family);background-color:var(--dark-bg);color:var(--text-primary);min-height:100vh;display:flex;justify-content:center;align-items:flex-start;padding:20px 20px 100px 20px;position:relative;overflow-x:hidden}.body-no-scroll{overflow-y:hidden}body::before,body::after{content:'';position:absolute;width:500px;height:500px;background:radial-gradient(circle, var(--accent) 0%, rgba(0,245,195,0) 70%);border-radius:50%;filter:blur(100px);z-index:-1;animation:move-glow 15s infinite alternate}body::before{top:-10%;left:-10%}body::after{bottom:-10%;right:-10%;animation-delay:-7.5s}@keyframes move-glow{from{transform:translate(0, 0) rotate(0deg)}to{transform:translate(100px, 50px) rotate(45deg)}}.container{width:100%;max-width:600px;background:var(--container-bg);backdrop-filter:blur(20px);-webkit-backdrop-filter:blur(20px);border:1px solid var(--border-color);border-radius:24px;padding:25px 30px;box-shadow:0 8px 32px rgba(0, 0, 0, 0.3);animation:fade-in 0.5s cubic-bezier(0.165, 0.84, 0.44, 1) forwards;opacity:0;transform:translateY(20px)}@keyframes fade-in{to{opacity:1;transform:translateY(0)}}.view{animation:view-fade-in 0.4s ease-out}@keyframes view-fade-in{from{opacity:0}to{opacity:1}}.hidden{display:none}h1,h2{font-size:28px;font-weight:700;text-align:center;margin-bottom:25px;display:flex;align-items:center;justify-content:center;gap:12px;color:var(--text-primary);position:relative}h1 .header-icon{color:var(--accent);animation:subtle-glow 3s infinite alternate}#fullscreen-btn{position:absolute;left:0;top:50%;transform:translateY(-50%);color:var(--text-secondary);cursor:pointer;font-size:16px;padding:8px;transition:color 0.2s}#fullscreen-btn:hover{color:var(--accent)}@keyframes subtle-glow{from{text-shadow:0 0 5px var(--shadow-color), 0 0 10px var(--shadow-color)}to{text-shadow:0 0 15px var(--shadow-color), 0 0 30px var(--shadow-color)}}.section{margin-bottom:25px}.section-title{font-size:18px;font-weight:600;color:var(--text-primary);margin-bottom:15px;padding-bottom:8px;border-bottom:1px solid var(--border-color);display:flex;align-items:center;justify-content:space-between;gap:10px}.section-title i{color:var(--accent)}.section-title .title-text{display:flex;align-items:center;gap:10px}.result-container{display:grid;grid-template-columns:repeat(auto-fit, minmax(120px, 1fr));gap:15px}.result-box{background:var(--input-bg);padding:15px;border-radius:12px;text-align:center;border:1px solid transparent;transition:all 0.2s ease}.result-box:hover{border-color:var(--accent);transform:translateY(-3px)}.result-title{font-size:13px;color:var(--text-secondary);margin-bottom:8px;font-weight:400}.result-value{font-size:20px;font-weight:700;color:var(--text-primary)}.input-group{margin-bottom:15px}label{display:block;font-size:14px;font-weight:400;color:var(--text-secondary);margin-bottom:8px}.input-wrapper{display:flex;gap:10px}input,select{width:100%;background:var(--input-bg);border:1px solid var(--border-color);border-radius:10px;padding:12px 15px;font-size:15px;color:var(--text-primary);font-family:inherit;transition:all 0.2s ease-in-out}input::placeholder{color:var(--text-secondary)}input:focus,select:focus{outline:none;border-color:var(--accent);box-shadow:0 0 0 3px var(--shadow-color)}select option{background-color:var(--dark-bg)}.btn{width:100%;padding:12px 15px;font-size:16px;font-weight:600;font-family:inherit;border-radius:10px;border:none;cursor:pointer;transition:all 0.2s ease-in-out;display:flex;align-items:center;justify-content:center;gap:8px}.btn-primary{background-color:var(--accent);color:var(--dark-bg);box-shadow:0 4px 15px var(--shadow-color)}.btn-primary:hover{background-color:var(--accent-dark);transform:translateY(-2px);box-shadow:0 6px 20px var(--shadow-color)}.btn-secondary{background-color:transparent;color:var(--text-secondary);border:1px solid var(--border-color)}.btn-secondary:hover{background-color:var(--input-bg);color:var(--text-primary);border-color:var(--text-secondary)}.btn-danger{color:var(--danger);border-color:var(--danger)}.btn-danger:hover{background-color:rgba(239, 68, 68, 0.1)}.action-btns{display:grid;grid-template-columns:1fr 1fr;gap:15px;margin-top:10px}.device-table{width:100%;border-collapse:separate;border-spacing:0 10px}.device-table thead th{text-align:right;padding:0 15px 10px;color:var(--text-secondary);font-size:13px;font-weight:400;text-transform:uppercase;border-bottom:1px solid var(--border-color)}.device-table tbody tr{background-color:var(--input-bg);border-radius:12px;transition:all 0.2s ease;animation:pop-in 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;opacity:0;transform:scale(0.95)}@keyframes pop-in{to{opacity:1;transform:scale(1)}}.device-table tbody tr:hover{transform:scale(1.02);box-shadow:0 4px 20px rgba(0,0,0,0.2);background-color:rgba(51, 65, 85, 0.8)}.device-table td{padding:15px;vertical-align:middle}.device-table td:first-child{border-radius:0 12px 12px 0}.device-table td:last-child{border-radius:12px 0 0 12px;text-align:left}.action-buttons{display:flex;gap:10px}.action-btn{background:rgba(255, 255, 255, 0.05);border:1px solid var(--border-color);color:var(--text-secondary);width:32px;height:32px;border-radius:8px;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all 0.2s ease}.action-btn:hover{color:var(--dark-bg);border-color:var(--accent);background-color:var(--accent)}.empty-state{text-align:center;padding:40px 20px;color:var(--text-secondary)}.empty-state i{font-size:32px;margin-bottom:15px;display:block;color:var(--accent);opacity:0.5}.confirmation-dialog{position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0, 0, 0, 0.7);display:flex;align-items:center;justify-content:center;z-index:1000;opacity:0;visibility:hidden;transition:all 0.2s ease;backdrop-filter:blur(5px)}.confirmation-dialog.active{opacity:1;visibility:visible}.dialog-content{background:var(--container-bg);padding:30px;border-radius:16px;width:90%;max-width:400px;border:1px solid var(--border-color);box-shadow:0 10px 30px rgba(0, 0, 0, 0.2);transform:scale(0.95);transition:transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275)}.confirmation-dialog.active .dialog-content{transform:scale(1)}.dialog-title{font-size:20px;font-weight:600;text-align:center;margin-bottom:20px}.dialog-message{margin-bottom:25px;font-size:18px;text-align:center}.dialog-buttons{display:flex;gap:15px}.dialog-btn{flex:1;padding:10px 20px;border-radius:8px;border:none;cursor:pointer;font-weight:600;transition:all 0.2s ease}.dialog-btn-confirm{background:var(--accent);color:var(--dark-bg)}.dialog-btn-danger{background:var(--danger);color:white}.dialog-btn-cancel{background:var(--input-bg);color:var(--text-secondary)}.toast{position:fixed;top:20px;left:50%;transform:translateX(-50%);padding:12px 20px;border-radius:12px;color:white;display:flex;align-items:center;gap:10px;min-width:250px;box-shadow:0 4px 12px rgba(0, 0, 0, 0.2);z-index:1001;backdrop-filter:blur(10px);animation:slideDownToast 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards}.toast-success{background:rgba(34, 197, 94, 0.7);border:1px solid var(--success)}.toast-error{background:rgba(239, 68, 68, 0.7);border:1px solid var(--danger)}@keyframes slideDownToast{from{transform:translate(-50%, -100px);opacity:0}to{transform:translate(-50%, 0);opacity:1}}@keyframes slideUpToast{to{transform:translate(-50%, -100px);opacity:0}}.bottom-nav{position:fixed;bottom:0;left:0;right:0;background:var(--container-bg);backdrop-filter:blur(10px);-webkit-backdrop-filter:blur(10px);border-top:1px solid var(--border-color);display:flex;justify-content:space-around;padding:10px 0;z-index:999;box-shadow:0 -5px 20px rgba(0,0,0,0.2)}.nav-btn{background:none;border:none;color:var(--text-secondary);cursor:pointer;display:flex;flex-direction:column;align-items:center;gap:4px;font-size:12px;font-family:inherit;transition:color 0.2s;position:relative;padding:5px 10px;width:20%}.nav-btn i{font-size:20px}.nav-btn.active{color:var(--accent)}.nav-btn .btn-badge{position:absolute;top:-2px;right:5px;background-color:var(--accent);color:var(--dark-bg);font-size:10px;font-weight:700;border-radius:10px;padding:2px 6px}.history-cards-container{display:grid;gap:15px}.history-card{background:var(--input-bg);border-radius:12px;padding:15px;border-left:4px solid var(--accent);display:grid;grid-template-areas:"info actions" "stats actions";grid-template-columns:1fr auto;gap:10px 15px;align-items:center}.history-card .info{grid-area:info;color:var(--text-primary);font-size:16px;font-weight:600}.history-card .stats{grid-area:stats;display:flex;gap:20px;color:var(--text-secondary);font-size:14px}.history-card .actions{grid-area:actions}@media (max-width: 640px){body{padding:10px 10px 100px 10px}.container{padding:20px}h1,h2{font-size:24px}#fullscreen-btn{font-size:14px}.result-container{grid-template-columns:1fr 1fr}.action-btns{grid-template-columns:1fr}}</style>
</head>
<body>
    <div class="container">
        <!-- ... HTMLی ناوەڕۆکی لاپەڕە وەک خۆی بمێنێتەوە ... -->
        <div id="main-view" class="view">
             <h1><i id="fullscreen-btn" class="fas fa-expand" title="پڕکردنی شاشە"></i><i class="fas fa-bolt header-icon"></i><span>هەژمارکردنی کارەبا</span></h1><div class="section"><h3 class="section-title"><div class="title-text"><i class="fas fa-chart-pie"></i>ئەنجامە گشتییەکان (بەپێی ئامێرەکان)</div></h3><div class="result-container"><div class="result-box"><div class="result-title">کۆی kW</div><div class="result-value" id="totalKilowatt">0</div></div><div class="result-box"><div class="result-title">kWh ڕۆژانە</div><div class="result-value" id="totalKwh">0</div></div><div class="result-box"><div class="result-title">kWh مانگانە</div><div class="result-value" id="totalKilowattMonth">0</div></div><div class="result-box"><div class="result-title">نرخ بە دینار</div><div class="result-value" id="totalDinar">0</div></div></div></div><div class="section"><h3 class="section-title"><div class="title-text"><i class="fas fa-plus-circle"></i>زیادکردنی ئامێر</div></h3><div class="input-group"><label for="deviceName">ناوی ئامێر</label><input type="text" id="deviceName" placeholder="بۆ نمونە: سپلێت"></div><div class="input-wrapper"><div class="input-group" style="flex: 1;"><label for="deviceUnit">یەکە</label><select id="deviceUnit"><option value="watt" selected>وات (W)</option><option value="ampere">ئەمپێر (A)</option></select></div><div class="input-group" style="flex: 2;"><label for="deviceValue">بڕ</label><input type="number" id="deviceValue" placeholder="بڕی وات یان ئەمپێر" min="0" step="0.1"></div><div class="input-group" style="flex: 1;"><label for="deviceQuantity">ژمارە</label><input type="number" id="deviceQuantity" value="1" min="1" step="1"></div></div><div class="input-group"><label for="deviceHours">کاتژمێری بەکارهێنان (ڕۆژانە)</label><input type="number" id="deviceHours" placeholder="بۆ نمونە: 8" min="0" step="0.1"></div><button class="btn btn-primary" id="addDeviceBtn"><i class="fas fa-plus"></i><span>زیادکردنی ئامێر</span></button></div>
        </div>
        <div id="devices-view" class="view hidden">
            <h2 class="section-title"><div class="title-text"><i class="fas fa-list-ul"></i>ئامێرە زیادکراوەکان</div></h2><div class="section"><table class="device-table"><thead><tr><th>ناوی ئامێر</th><th>وات</th><th>کاتژمێر</th><th>ژمارە</th><th>کردار</th></tr></thead><tbody id="devicesTableBody"></tbody></table><div id="emptyState" class="empty-state"><i class="fas fa-box-open"></i><p>هیچ ئامێرێک زیاد نەکراوە</p></div></div><div class="action-btns"><button class="btn btn-secondary" id="saveDataBtn"><i class="fas fa-save"></i>پاشەکەوتکردن</button><button class="btn btn-secondary btn-danger" id="clearDataBtn"><i class="fas fa-trash-alt"></i>پاککردنەوەی هەمووی</button></div>
        </div>
        <div id="kwh-diff-view" class="view hidden">
            <h2 class="section-title"><div class="title-text"><i class="fas fa-exchange-alt"></i>جیاوازیی پێوەر</div></h2><div class="section"><div class="input-group"><label for="prevReading">خوێندنەوەی پێشوو (kWh)</label><input type="number" id="prevReading" placeholder="0" min="0"></div><div class="input-group"><label for="currentReading">خوێندنەوەی ئێستا (kWh)</label><input type="number" id="currentReading" placeholder="0" min="0"></div><button class="btn btn-primary" id="calculateDiffBtn"><i class="fas fa-calculator"></i><span>هەژمارکردن</span></button></div><div class="section hidden" id="diffResultSection"><h3 class="section-title"><div class="title-text"><i class="fas fa-chart-bar"></i>ئەنجام</div></h3><div class="result-container"><div class="result-box"><div class="result-title">kWhی بەکارهاتوو</div><div class="result-value" id="kwhConsumedResult">0</div></div><div class="result-box"><div class="result-title">نرخی گشتی (دینار)</div><div class="result-value" id="totalCostResult">0</div></div></div><div class="input-group" style="margin-top: 20px;"><label for="historyDate">مانگ بۆ ئەم تۆمارە</label><input type="month" id="historyDate"></div><button class="btn btn-secondary" id="saveToHistoryBtn" style="margin-top: 10px;"><i class="fas fa-save"></i><span>پاشەکەوتکردن لە مێژوو</span></button></div>
        </div>
        <div id="quick-calc-view" class="view hidden">
            <h2 class="section-title"><div class="title-text"><i class="fas fa-search-dollar"></i>هەژمارکردنی خێرا</div></h2><div class="section"><div class="input-group"><label for="quickKwhInput">بڕی کیلۆوات (kWh)</label><input type="number" id="quickKwhInput" placeholder="بۆ نمونە: 450" min="0"></div><button class="btn btn-primary" id="quickCalcBtn"><i class="fas fa-calculator"></i><span>هەژمارکردنی نرخ</span></button></div><div class="section hidden" id="quickResultSection"><h3 class="section-title"><div class="title-text"><i class="fas fa-money-bill-wave"></i>نرخی کۆتایی</div></h3><div class="result-container" style="grid-template-columns: 1fr;"><div class="result-box"><div class="result-title">نرخ بە دیناری عێراقی</div><div class="result-value" id="quickCostResult">0</div></div></div></div>
        </div>
        <div id="history-view" class="view hidden">
            <h2 class="section-title"><div class="title-text"><i class="fas fa-history"></i>مێژووی بەکارهێنان</div></h2><div class="section"><div id="history-cards-container"></div><div id="historyEmptyState" class="empty-state"><i class="fas fa-archive"></i><p>هیچ تۆمارێک لە مێژوودا نییە</p></div></div>
        </div>
    </div>
    <nav class="bottom-nav">
        <button class="nav-btn active" data-view="main-view"><i class="fas fa-calculator"></i><span>هەژمارکەر</span></button>
        <button class="nav-btn" data-view="devices-view"><i class="fas fa-list-ul"></i><span>ئامێرەکان</span><span class="btn-badge" id="navDeviceCountBadge">0</span></button>
        <button class="nav-btn" data-view="kwh-diff-view"><i class="fas fa-exchange-alt"></i><span>پێوەر</span></button>
        <button class="nav-btn" data-view="quick-calc-view"><i class="fas fa-search-dollar"></i><span>نرخ</span></button>
        <button class="nav-btn" data-view="history-view"><i class="fas fa-history"></i><span>مێژوو</span></button>
    </nav>
    <div class="confirmation-dialog" id="confirmationDialog">
        <div class="dialog-content"><div class="dialog-message" id="dialogMessage"></div><div class="dialog-buttons"><button class="dialog-btn dialog-btn-cancel">نەخێر</button><button class="dialog-btn dialog-btn-danger" id="dialogConfirm">بەڵێ</button></div></div>
    </div>
    <div class="confirmation-dialog" id="editHistoryDialog">
        <div class="dialog-content"><h3 class="dialog-title">دەستکاری تۆمار</h3><div class="input-group"><label for="editHistoryDate">بەروار</label><input type="month" id="editHistoryDate"></div><div class="input-group"><label for="editHistoryKwh">بڕی kWh</label><input type="number" id="editHistoryKwh" min="0"></div><div class="dialog-buttons"><button class="dialog-btn dialog-btn-cancel">پاشگەزبوونەوە</button><button class="dialog-btn dialog-btn-confirm" id="editHistoryConfirm">نوێکردنەوە</button></div></div>
    </div>
    <script>/*... هەموو سکریپتەکان وەک خۆی بمێننەوە ... */document.addEventListener('DOMContentLoaded',function(){const e=document.querySelectorAll('.view'),t=document.querySelectorAll('.nav-btn'),o=document.getElementById('fullscreen-btn'),n=document.getElementById('deviceName'),a=document.getElementById('deviceUnit'),i=document.getElementById('deviceValue'),l=document.getElementById('deviceQuantity'),s=document.getElementById('deviceHours'),c=document.getElementById('addDeviceBtn'),r=document.getElementById('totalKilowatt'),d=document.getElementById('totalKilowattMonth'),u=document.getElementById('totalKwh'),m=document.getElementById('totalDinar'),h=document.getElementById('devicesTableBody'),y=document.getElementById('emptyState'),v=document.getElementById('saveDataBtn'),g=document.getElementById('clearDataBtn'),b=document.getElementById('navDeviceCountBadge'),w=document.getElementById('prevReading'),p=document.getElementById('currentReading'),k=document.getElementById('calculateDiffBtn'),f=document.getElementById('diffResultSection'),I=document.getElementById('kwhConsumedResult'),E=document.getElementById('totalCostResult'),x=document.getElementById('historyDate'),L=document.getElementById('saveToHistoryBtn'),H=document.getElementById('history-cards-container'),S=document.getElementById('historyEmptyState'),B=document.getElementById('quickKwhInput'),C=document.getElementById('quickCalcBtn'),A=document.getElementById('quickResultSection'),T=document.getElementById('quickCostResult'),q=document.getElementById('confirmationDialog'),D=document.getElementById('editHistoryDialog');let N=[],M=[],V=null,z=null,P={kwh:0,cost:0};const U=220,W=e=>e.toString().replace(/\B(?=(\d{3})+(?!\d))/g,','),G=e=>(e=Math.max(0,e))<=400?72*e:e<=800?28800+108*(e-400):e<=1200?72e3+175*(e-800):e<=1600?142e3+265*(e-1200):248e3+350*(e-1600),J=(e,t)=>{const o=document.createElement('div');o.className=`toast toast-${t}`,o.innerHTML=e,document.body.appendChild(o),setTimeout(()=>{o.style.animation='slideUpToast 0.3s forwards',setTimeout(()=>o.remove(),300)},2500)},K=(e,t)=>{q.querySelector('#dialogMessage').textContent=e,q.classList.add('active');const o=()=>{t(),n()};var n=()=>{q.classList.remove('active'),q.querySelector('#dialogConfirm').removeEventListener('click',o),q.querySelector('.dialog-btn-cancel').removeEventListener('click',n)};q.querySelector('#dialogConfirm').addEventListener('click',o),q.querySelector('.dialog-btn-cancel').addEventListener('click',n)},Q=t=>{window.scrollTo(0,0),e.forEach(e=>e.classList.toggle('hidden',e.id!==t)),navButtons.forEach(e=>e.classList.toggle('active',e.dataset.view===t)),document.body.classList.toggle('body-no-scroll','main-view'===t||'quick-calc-view'===t)};t.forEach(e=>e.addEventListener('click',()=>Q(e.dataset.view))),o.addEventListener('click',()=>{document.fullscreenElement?document.exitFullscreen():document.documentElement.requestFullscreen().catch(e=>console.error(`Fullscreen error: ${e.message}`))}),document.addEventListener('fullscreenchange',()=>{const e=o;document.fullscreenElement?(e.classList.replace('fa-expand','fa-compress'),e.title='دەرچوون لە پڕکردنی شاشە'):(e.classList.replace('fa-compress','fa-expand'),e.title='پڕکردنی شاشە')});const R=()=>{ne(),ae(),b.textContent=N.length},O=()=>{n.value='',i.value='',s.value='',l.value='1',a.value='watt',V=null,c.innerHTML='<i class="fas fa-plus"></i> <span>زیادکردنی ئامێر</span>',n.focus()};c.addEventListener('click',()=>{const e=n.value.trim(),t=a.value,o=parseFloat(i.value),r=parseInt(l.value),d=parseFloat(s.value);if(!e||isNaN(o)||o<=0||isNaN(d)||d<0||isNaN(r)||r<=0)return void J('<i class="fas fa-exclamation-triangle"></i> تکایە هەموو خانەکان بە دروستی پڕبکەرەوە','error');const u='ampere'===t?o*U:o;V?(N[N.findIndex(e=>e.id===V)]={id:V,name:e,watt:u,hours:d,quantity:r},J('<i class="fas fa-check-circle"></i> ئامێرەکە نوێکرایەوە','success')):(N.push({id:Date.now(),name:e,watt:u,hours:d,quantity:r}),J('<i class="fas fa-check-circle"></i> ئامێرەکە زیادکرا','success')),R(),O()});var ne=()=>{const e=0===N.length;y.style.display=e?'block':'none',h.parentElement.style.display=e?'none':'table',h.innerHTML=N.map((e,t)=>`<tr style="animation-delay: ${30*t}ms"><td>${e.name}</td><td>${e.watt.toFixed(1)}</td><td>${e.hours}</td><td>${e.quantity}</td><td><div class="action-buttons"><button class="action-btn edit-btn" data-id="${e.id}" title="دەستکاری"><i class="fas fa-edit"></i></button><button class="action-btn delete-btn" data-id="${e.id}" title="سڕینەوە"><i class="fas fa-trash-alt"></i></button></div></td></tr>`).join('')};h.addEventListener('click',e=>{const t=e.target.closest('.action-btn');if(!t)return;const o=parseInt(t.dataset.id);if(t.classList.contains('edit-btn')){const e=N.find(e=>e.id===o);e&&(n.value=e.name,a.value='watt',i.value=e.watt,s.value=e.hours,l.value=e.quantity,V=o,c.innerHTML='<i class="fas fa-save"></i> <span>نوێکردنەوەی ئامێر</span>',Q('main-view'),n.focus())}else t.classList.contains('delete-btn')&&K('دڵنیایت دەتەوێت ئەم ئامێرە بسڕیتەوە؟',()=>{N=N.filter(e=>e.id!==o),R(),J('<i class="fas fa-trash-alt"></i> ئامێرەکە سڕایەوە','error')})});var ae=()=>{const e=N.reduce((e,t)=>e+t.watt*t.quantity,0),t=N.reduce((e,t)=>e+t.watt*t.quantity/1e3*t.hours,0),o=e/1e3,n=30*t,a=G(n);r.textContent=o.toFixed(3),u.textContent=t.toFixed(3),d.textContent=n.toFixed(3),m.textContent=W(Math.floor(a))};k.addEventListener('click',()=>{const e=parseFloat(w.value)||0,t=parseFloat(p.value)||0;if(t<e)return void J('<i class="fas fa-exclamation-triangle"></i> خوێندنەوەی ئێستا نابێت لە پێشوو کەمتر بێت','error');const o=t-e,n=G(o);P={kwh:o,cost:n},I.textContent=o.toFixed(2),E.textContent=W(Math.floor(n)),f.classList.remove('hidden');const a=new Date,i=a.getFullYear(),l=(a.getMonth()+1).toString().padStart(2,'0');x.value=`${i}-${l}`}),L.addEventListener('click',()=>{const e=x.value;if(!e)return void J('<i class="fas fa-exclamation-triangle"></i> تکایە مانگ دیاریبکە','error');M.push({id:Date.now(),date:e,kwh:P.kwh,cost:P.cost}),ie(),oe(),J('<i class="fas fa-check-circle"></i> تۆمارەکە پاشەکەوتکرا','success')});const ie=()=>{re()};var re=()=>{M.sort((e,t)=>new Date(t.date)-new Date(e.date));const e=0===M.length;S.style.display=e?'block':'none',H.style.display=e?'none':'grid',H.innerHTML=M.map(e=>`<div class="history-card"><div class="info">${new Date(e.date+'-02').toLocaleDateString('ku-IQ',{year:'numeric',month:'long'})}</div><div class="stats"><span><i class="fas fa-bolt"></i> ${e.kwh.toFixed(1)} kWh</span><span><i class="fas fa-money-bill-wave"></i> ${W(Math.floor(e.cost))} دینار</span></div><div class="actions action-buttons"><button class="action-btn edit-history-btn" data-id="${e.id}" title="دەستکاری"><i class="fas fa-edit"></i></button><button class="action-btn delete-history-btn" data-id="${e.id}" title="سڕینەوە"><i class="fas fa-trash-alt"></i></button></div></div>`).join('')};H.addEventListener('click',e=>{const t=e.target.closest('.action-btn');if(!t)return;const o=parseInt(t.dataset.id);t.classList.contains('delete-history-btn')?K('دڵنیایت دەتەوێت ئەم تۆمارە بسڕیتەوە؟',()=>{M=M.filter(e=>e.id!==o),ie(),oe(),J('<i class="fas fa-trash-alt"></i> تۆمارەکە سڕایەوە','error')}):t.classList.contains('edit-history-btn')&&(z=o,e=M.find(e=>e.id===o))&&(D.querySelector('#editHistoryDate').value=e.date,D.querySelector('#editHistoryKwh').value=e.kwh,D.classList.add('active'))}),D.querySelector('#editHistoryConfirm').addEventListener('click',()=>{const e=D.querySelector('#editHistoryDate').value,t=parseFloat(D.querySelector('#editHistoryKwh').value);if(!e||isNaN(t)||t<0)return void J('<i class="fas fa-exclamation-triangle"></i> تکایە زانیارییەکان بە دروستی پڕبکەرەوە','error');const o=M.findIndex(e=>e.id===z);o>-1&&(M[o].date=e,M[o].kwh=t,M[o].cost=G(t)),ie(),oe(),D.classList.remove('active'),z=null,J('<i class="fas fa-check-circle"></i> تۆمارەکە نوێکرایەوە','success')}),D.querySelector('.dialog-btn-cancel').addEventListener('click',()=>{D.classList.remove('active'),z=null}),C.addEventListener('click',()=>{const e=parseFloat(B.value);if(isNaN(e)||e<0)return void J('<i class="fas fa-exclamation-triangle"></i> تکایە بڕێکی دروست بنووسە','error');const t=G(e);T.textContent=W(Math.floor(t)),A.classList.remove('hidden')}),B.addEventListener('input',()=>{A.classList.add('hidden')});const le=()=>{try{const e=localStorage.getItem('electricityDevices');N=e?JSON.parse(e):[];const t=localStorage.getItem('electricityHistory');M=t?JSON.parse(t):[]}catch(e){console.error('Could not parse localStorage data:',e),N=[],M=[]}R(),ie()},se=()=>{localStorage.setItem('electricityDevices',JSON.stringify(N)),J('<i class="fas fa-check-circle"></i> داتای ئامێرەکان پاشەکەوتکران','success')},oe=()=>{localStorage.setItem('electricityHistory',JSON.stringify(M))},ce=()=>{K('دڵنیایت دەتەوێت هەموو داتای ئامێرەکان بسڕیتەوە؟',()=>{N=[],localStorage.removeItem('electricityDevices'),R(),J('<i class="fas fa-trash-alt"></i> هەموو داتای ئامێرەکان سڕانەوە','error')})};v.addEventListener('click',se),g.addEventListener('click',ce),le(),Q('main-view')})</script>
    <script>
      // Corrected Service Worker Registration for Karaba-update
      if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
          navigator.serviceWorker.register('/Karaba-update/sw.js', { scope: '/Karaba-update/' })
            .then(registration => {
              console.log('SW registered with scope: ', registration.scope);
            }).catch(err => {
              console.log('SW registration failed: ', err);
            });
        });
      }
    </script>
</body>
</html>